import{j as c}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.BVOCwoKb.js";const n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));function I(e,t=0){return(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase()}let p;const S=new Uint8Array(16);function L(){if(!p){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");p=crypto.getRandomValues.bind(crypto)}return p(S)}const U=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),f={randomUUID:U};function j(e,t,i){if(f.randomUUID&&!e)return f.randomUUID();e=e||{};const r=e.random??e.rng?.()??L();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,I(r)}const w=async({slug:e,userId:t})=>{try{return await(await fetch("https://handlelike-3hjph2wfea-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t?{slug:e,userId:t}:{slug:e}),credentials:"omit"})).json()}catch(i){return{success:!1,message:i.message||"Error de red o formato de respuesta"}}};function D({slug:e,initialLikes:t}){const[i,r]=a.useState(t),[u,y]=a.useState(!1),[h,d]=a.useState(""),[l,x]=a.useState(null),[m,g]=a.useState(!1);a.useEffect(()=>{let o=!1;async function k(){try{const s=await w({slug:e});!o&&s&&typeof s.newLikes=="number"&&r(s.newLikes)}catch{}}if(typeof window<"u"){let s=localStorage.getItem("userId");s||(s=j(),localStorage.setItem("userId",s)),x(s),g(localStorage.getItem(`liked-${e}-${s}`)==="true"),k()}return()=>{o=!0}},[e]);const b=async()=>{if(!e){d("No se pudo identificar el artículo.");return}if(!l){d("Espera un momento e inténtalo de nuevo.");return}y(!0),d("");try{const o=await w({slug:e,userId:l});o&&o.success?(r(o.newLikes),typeof window<"u"&&(localStorage.setItem(`liked-${e}-${l}`,"true"),g(!0))):d(o?.message||"Error al dar like")}catch(o){d(o.message||"Ocurrió un error")}finally{y(!1)}};return c.jsxs("div",{children:[c.jsxs("button",{className:`px-4 py-2 rounded font-semibold transition-colors duration-200 flex items-center gap-2 ${m?"bg-emerald-700 text-emerald-100 cursor-not-allowed":"bg-zinc-800 text-zinc-300 hover:bg-emerald-600 hover:text-white"} ${u?"opacity-50 cursor-wait":""}`,onClick:b,disabled:u||m,"aria-label":m?"Ya diste like":"Dar like",children:[c.jsx("span",{className:"icon",children:"❤️"})," ",i]}),h&&c.jsx("div",{className:"error",children:h})]})}export{D as default};
