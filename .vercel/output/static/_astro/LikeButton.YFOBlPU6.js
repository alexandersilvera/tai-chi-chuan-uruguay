import{j as d}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.BJfUAbRs.js";const n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));function I(e,t=0){return(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase()}let p;const S=new Uint8Array(16);function L(){if(!p){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");p=crypto.getRandomValues.bind(crypto)}return p(S)}const U=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),f={randomUUID:U};function j(e,t,i){if(f.randomUUID&&!e)return f.randomUUID();e=e||{};const o=e.random??e.rng?.()??L();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,I(o)}const w=async({slug:e,userId:t})=>{try{return await(await fetch("https://handlelike-3hjph2wfea-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t?{slug:e,userId:t}:{slug:e}),credentials:"omit"})).json()}catch(i){return{success:!1,message:i.message||"Error de red o formato de respuesta"}}};function D({slug:e,initialLikes:t}){const[i,o]=a.useState(t),[l,y]=a.useState(!1),[h,c]=a.useState(""),[u,k]=a.useState(null),[m,g]=a.useState(!1);a.useEffect(()=>{let s=!1;async function b(){try{const r=await w({slug:e});!s&&r&&typeof r.newLikes=="number"&&o(r.newLikes)}catch(r){console.error("Error fetching initial likes:",r)}}if(typeof window<"u"){let r=localStorage.getItem("userId");r||(r=j(),localStorage.setItem("userId",r)),k(r),g(localStorage.getItem(`liked-${e}-${r}`)==="true"),b()}return()=>{s=!0}},[e]);const x=async()=>{if(!e){c("No se pudo identificar el artículo.");return}if(!u){c("Espera un momento e inténtalo de nuevo.");return}y(!0),c("");try{const s=await w({slug:e,userId:u});s&&s.success?(o(s.newLikes),typeof window<"u"&&(localStorage.setItem(`liked-${e}-${u}`,"true"),g(!0))):c(s?.message||"Error al dar like")}catch(s){c(s.message||"Ocurrió un error")}finally{y(!1)}};return d.jsxs("div",{children:[d.jsxs("button",{className:`px-4 py-2 rounded font-semibold transition-colors duration-200 flex items-center gap-2 ${m?"bg-emerald-700 text-emerald-100 cursor-not-allowed":"bg-zinc-800 text-zinc-300 hover:bg-emerald-600 hover:text-white"} ${l?"opacity-50 cursor-wait":""}`,onClick:x,disabled:l||m,"aria-label":m?"Ya diste like":"Dar like",children:[d.jsx("span",{className:"icon",children:"❤️"})," ",i]}),h&&d.jsx("div",{className:"error",children:h})]})}export{D as default};
