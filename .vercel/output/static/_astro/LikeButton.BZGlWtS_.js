import{j as d}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.BVOCwoKb.js";const n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).slice(1));function f(e,t=0){return(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase()}let l;const b=new Uint8Array(16);function k(){if(!l){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");l=crypto.getRandomValues.bind(crypto)}return l(b)}const I=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),h={randomUUID:I};function S(e,t,a){if(h.randomUUID&&!e)return h.randomUUID();e=e||{};const o=e.random??e.rng?.()??k();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,f(o)}const U=async({slug:e,userId:t})=>{try{return await(await fetch("https://handlelike-3hjph2wfea-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:e,userId:t}),credentials:"omit"})).json()}catch(a){return{success:!1,message:a.message||"Error de red o formato de respuesta"}}};function E({slug:e,initialLikes:t}){const[a,o]=s.useState(t),[m,p]=s.useState(!1),[y,i]=s.useState(""),[c,x]=s.useState(null),[u,g]=s.useState(!1);s.useEffect(()=>{if(typeof window<"u"){let r=localStorage.getItem("userId");r||(r=S(),localStorage.setItem("userId",r)),x(r),g(localStorage.getItem(`liked-${e}-${r}`)==="true")}},[e]);const w=async()=>{if(!e){i("No se pudo identificar el artículo.");return}if(!c){i("Espera un momento e inténtalo de nuevo.");return}p(!0),i("");try{const r=await U({slug:e,userId:c});r&&r.success?(o(r.newLikes),typeof window<"u"&&(localStorage.setItem(`liked-${e}-${c}`,"true"),g(!0))):i(r?.message||"Error al dar like")}catch(r){i(r.message||"Ocurrió un error")}finally{p(!1)}};return d.jsxs("div",{children:[d.jsxs("button",{className:`px-4 py-2 rounded font-semibold transition-colors duration-200 flex items-center gap-2 ${u?"bg-emerald-700 text-emerald-100 cursor-not-allowed":"bg-zinc-800 text-zinc-300 hover:bg-emerald-600 hover:text-white"} ${m?"opacity-50 cursor-wait":""}`,onClick:w,disabled:m||u,"aria-label":u?"Ya diste like":"Dar like",children:[d.jsx("span",{className:"icon",children:"❤️"})," ",a]}),y&&d.jsx("div",{className:"error",children:y})]})}export{E as default};
